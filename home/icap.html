<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ICAP — SIGCPEF</title>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styleHome.css">
  <link rel="ico" href="https://i.postimg.cc/pdxN5cJ7/logotipo.png">
</head>
<body>
  <header class="py-2">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <img src="/img/logotipo.png" alt="logo" style="width:52px;height:52px;object-fit:contain">
        <div class="ms-3">
          <h4 class="mb-0">SIGCPEF</h4>
          <small class="text-muted">Cuerpo Policial del Estado Falcón</small>
        </div>
      </div>
      <nav>
        <a class="me-3 text-decoration-none" href="home.html"><i class='bx bxs-home'></i>INICIO</a>
        <a class="me-3 text-decoration-none" href="operaciones.html"><i class='bx bxs-shield'></i>OPERACIONES</a>
        <a class="me-3 text-decoration-none" href="rrhh.html"><i class='bx bxs-user-account'></i>RR-HH</a>
        <a class="me-3 text-decoration-none" href="icap.html"><i class='bx bxs-user-x'></i>ICAP</a>
      </nav>
    </div>
  </header>

  <main class="container py-4">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">ICAP — Sanciones</h5>
        <div class="d-flex gap-2">
          <input id="icapSearchPage" type="search" class="form-control form-control-sm" placeholder="Buscar por nombre, apellido o C.I.">
          <button id="icapNewPageBtn" class="btn btn-sm btn-warning">Registrar sanción</button>
        </div>
      </div>
      <div class="card-body">
        <div id="icapResultsPage"></div>
      </div>
    </div>
  </main>

  <footer class="py-3 bg-light mt-auto">
    <div class="container text-center text-muted">© 2025 Derechos reservados - Comisario Yefir Rivero.</div>
  </footer>

  <div id="icapModalsPlace"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="scriptHome.js"></script>
  <script>
    // insert icap modal markup
    (function(){
      const tpl=`<div class="modal fade" id="icapModal" tabindex="-1"><div class="modal-dialog modal-md"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Registrar sanción</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="icapForm"><div class="mb-3"><label class="form-label">C.I. del funcionario</label><input id="icapCI" class="form-control" required></div><div class="mb-3"><label class="form-label">Tipo de sanción</label><select id="icapTipo" class="form-select"><option value="Llamado de atención">Llamado de atención</option><option value="Asistencia involuntaria">Asistencia involuntaria</option><option value="Asistencia obligatoria">Asistencia obligatoria</option></select></div><div class="mb-3"><label class="form-label">Descripción (opcional)</label><textarea id="icapDesc" class="form-control" rows="3"></textarea></div></form></div><div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button id="saveIcapBtn" class="btn btn-warning">Registrar</button></div></div></div></div>`;
+      document.getElementById('icapModalsPlace').innerHTML = tpl;
+    })();
+
+    document.getElementById('icapNewPageBtn').addEventListener('click',()=>{document.getElementById('icapForm').reset(); new bootstrap.Modal(document.getElementById('icapModal')).show();});
+
+    function renderPage(){
+      const sanctions = window.SIG ? window.SIG.getSanctions() : JSON.parse(localStorage.getItem('sanctions')||'[]');
+      const container=document.getElementById('icapResultsPage');
+      if(sanctions.length===0){container.innerHTML='<p class="text-muted">No hay sanciones registradas.</p>';return}
+      container.innerHTML = `<div class="list-group">`+sanctions.map(s=>`<div class="list-group-item"><div class="d-flex w-100 justify-content-between"><div><strong>${s.name||'Sin registro'}</strong> <small class="text-muted">(${s.ci})</small></div><small>${new Date(s.datetime).toLocaleString()}</small></div><p class="mb-1">Tipo: ${s.tipo}</p><small class="text-muted">${s.desc||''}</small></div>`).join('')+`</div>`;
+    }
+
+    document.getElementById('icapSearchPage').addEventListener('input',(e)=>{
+      const q=e.target.value.trim().toLowerCase();
+      const arr=window.SIG ? window.SIG.getSanctions() : JSON.parse(localStorage.getItem('sanctions')||'[]');
+      const filtered = arr.filter(s=> (s.ci+' '+(s.name||'')+' '+s.tipo).toLowerCase().includes(q));
+      const container=document.getElementById('icapResultsPage');
+      if(filtered.length===0){container.innerHTML='<p class="text-muted">No hay resultados.</p>';return}
+      container.innerHTML = `<div class="list-group">`+filtered.map(s=>`<div class="list-group-item"><div class="d-flex w-100 justify-content-between"><div><strong>${s.name||'Sin registro'}</strong> <small class="text-muted">(${s.ci})</small></div><small>${new Date(s.datetime).toLocaleString()}</small></div><p class="mb-1">Tipo: ${s.tipo}</p><small class="text-muted">${s.desc||''}</small></div>`).join('')+`</div>`;
+    });
+
+    setTimeout(renderPage,150);
+  </script>
</body>
</html>